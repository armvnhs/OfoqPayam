-- حذف جداول قبلی برای جلوگیری از تداخل
DROP TABLE IF EXISTS messages;
DROP TABLE IF EXISTS users;

-- ساخت جدول کاربران
CREATE TABLE users (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- ساخت جدول پیام‌ها
CREATE TABLE messages (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    content TEXT NOT NULL,
    sender TEXT NOT NULL,
    is_admin BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- غیرفعال کردن سیستم امنیتی سخت‌گیرانه (RLS) برای راحتی کار
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE messages DISABLE ROW LEVEL SECURITY;

-- ساخت یوزر ادمین پیش‌فرض
INSERT INTO users (username, password) VALUES ('admin', 'admin');

-- فعال‌سازی قابلیت ریل‌تایم
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
